import React, { createContext, useState, useEffect, useContext } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';

// Create Context
export const LanguageContext = createContext();

// Available languages
export const SUPPORTED_LANGUAGES = {
  en: {
    code: 'en',
    name: 'English',
    nativeName: 'English',
    flag: 'üá∫üá∏',
  },
  es: {
    code: 'es',
    name: 'Spanish',
    nativeName: 'Espa√±ol',
    flag: 'üá™üá∏',
  },
  fr: {
    code: 'fr',
    name: 'French',
    nativeName: 'Fran√ßais',
    flag: 'üá´üá∑',
  },
  de: {
    code: 'de',
    name: 'German',
    nativeName: 'Deutsch',
    flag: 'üá©üá™',
  },
  it: {
    code: 'it',
    name: 'Italian',
    nativeName: 'Italiano',
    flag: 'üáÆüáπ',
  },
  pt: {
    code: 'pt',
    name: 'Portuguese',
    nativeName: 'Portugu√™s',
    flag: 'üáµüáπ',
  },
  ar: {
    code: 'ar',
    name: 'Arabic',
    nativeName: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',
    flag: 'üá∏üá¶',
  },
  zh: {
    code: 'zh',
    name: 'Chinese',
    nativeName: '‰∏≠Êñá',
    flag: 'üá®üá≥',
  },
  ja: {
    code: 'ja',
    name: 'Japanese',
    nativeName: 'Êó•Êú¨Ë™û',
    flag: 'üáØüáµ',
  },
  ko: {
    code: 'ko',
    name: 'Korean',
    nativeName: 'ÌïúÍµ≠Ïñ¥',
    flag: 'üá∞üá∑',
  },
  hi: {
    code: 'hi',
    name: 'Hindi',
    nativeName: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä',
    flag: 'üáÆüá≥',
  },
  ru: {
    code: 'ru',
    name: 'Russian',
    nativeName: '–†—É—Å—Å–∫–∏–π',
    flag: 'üá∑üá∫',
  },
};

// Translation strings
const TRANSLATIONS = {
  en: {
    // Common
    cancel: 'Cancel',
    confirm: 'Confirm',
    save: 'Save',
    delete: 'Delete',
    edit: 'Edit',
    done: 'Done',
    back: 'Back',
    next: 'Next',
    skip: 'Skip',
    continue: 'Continue',
    retry: 'Retry',
    close: 'Close',
    ok: 'OK',
    yes: 'Yes',
    no: 'No',
    
    // Navigation
    home: 'Home',
    profile: 'Profile',
    settings: 'Settings',
    transactions: 'Transactions',
    send: 'Send',
    receive: 'Receive',
    withdraw: 'Withdraw',
    deposit: 'Deposit',
    
    // Home Screen
    balance: 'Balance',
    quickActions: 'Quick Actions',
    recentTransactions: 'Recent Transactions',
    viewAll: 'View All',
    sendMoney: 'Send Money',
    receiveMoney: 'Receive Money',
    withdrawFunds: 'Withdraw Funds',
    depositFunds: 'Deposit Funds',
    
    // Send Modal
    sendToUser: 'Send to User',
    addContact: 'Add Contact',
    mobileMoney: 'Mobile Money',
    payInStore: 'Pay in Store',
    bankTransfer: 'Bank Transfer',
    cryptoTransfer: 'Crypto Transfer',
    payBills: 'Pay Bills',
    
    // Receive Modal
    generateInvoice: 'Generate Invoice',
    paymentLink: 'Payment Link',
    qrCode: 'QR Code',
    
    // Profile Settings
    accountSecurity: 'Account & Security',
    paymentCards: 'Payment & Cards',
    servicesUtilities: 'Services & Utilities',
    preferences: 'Preferences',
    supportLegal: 'Support & Legal',
    editProfile: 'Edit Profile',
    twoFactorAuth: 'Two-Factor Authentication',
    faceIdBiometric: 'FaceID / Biometric Login',
    testBiometric: 'Test Biometric',
    virtualCards: 'Virtual Cards',
    transactionLimits: 'Transaction Limits',
    notifications: 'Notifications',
    language: 'Language',
    darkMode: 'Dark Mode',
    buyAirtimeData: 'Buy Airtime & Data',
    billPayments: 'Bill Payments',
    giftCards: 'Gift Cards',
    cryptoServices: 'Crypto Services',
    helpSupport: 'Help & Support',
    contactUs: 'Contact Us',
    inviteFriends: 'Invite Friends',
    learningHub: 'Learning Hub',
    termsOfService: 'Terms of Service',
    privacyPolicy: 'Privacy Policy',
    
    // Biometric
    enableFaceId: 'Enable Face ID',
    enableTouchId: 'Enable Touch ID',
    enableBiometric: 'Enable Biometric',
    biometricEnabled: 'Biometric Enabled',
    biometricDisabled: 'Biometric Disabled',
    securityCode: 'Security Code',
    setSecurityCode: 'Set Security Code',
    enterSecurityCode: 'Enter Security Code',
    createSecurityCode: 'Create Security Code',
    confirmSecurityCode: 'Confirm Security Code',
    securityCodeSetup: 'Security Code Setup',
    biometricSetup: 'Biometric Setup',
    biometricTest: 'Biometric Test',
    
    // Airtime & Data
    buyAirtimeDataTitle: 'Buy Airtime & Data',
    serviceType: 'Service Type',
    airtime: 'Airtime',
    dataBundle: 'Data Bundle',
    phoneNumber: 'Phone Number',
    selectNetwork: 'Select Network',
    amount: 'Amount',
    selectDataBundle: 'Select Data Bundle',
    quickAmounts: 'Quick Amounts',
    purchase: 'Purchase',
    purchaseAirtime: 'Purchase Airtime',
    purchaseDataBundle: 'Purchase Data Bundle',
    
    // Transaction History
    transactionHistory: 'Transaction History',
    transactionDetails: 'Transaction Details',
    transactionId: 'Transaction ID',
    date: 'Date',
    time: 'Time',
    status: 'Status',
    amount: 'Amount',
    fee: 'Fee',
    total: 'Total',
    reference: 'Reference',
    description: 'Description',
    recipient: 'Recipient',
    sender: 'Sender',
    
    // Actions
    share: 'Share',
    copy: 'Copy',
    split: 'Split',
    report: 'Report',
    support: 'Support',
    
    // Status
    completed: 'Completed',
    pending: 'Pending',
    failed: 'Failed',
    cancelled: 'Cancelled',
    
    // Messages
    success: 'Success',
    error: 'Error',
    warning: 'Warning',
    info: 'Information',
    loading: 'Loading...',
    noData: 'No data available',
    tryAgain: 'Please try again',
    networkError: 'Network error',
    authenticationFailed: 'Authentication failed',
    biometricNotAvailable: 'Biometric not available',
    biometricSetupRequired: 'Biometric setup required',
    
    // Language Selector
    selectLanguage: 'Select Language',
    currentLanguage: 'Current Language',
    languageChanged: 'Language changed successfully',
    restartRequired: 'App restart required for full language change',
  },
  
  es: {
    // Common
    cancel: 'Cancelar',
    confirm: 'Confirmar',
    save: 'Guardar',
    delete: 'Eliminar',
    edit: 'Editar',
    done: 'Hecho',
    back: 'Atr√°s',
    next: 'Siguiente',
    skip: 'Omitir',
    continue: 'Continuar',
    retry: 'Reintentar',
    close: 'Cerrar',
    ok: 'OK',
    yes: 'S√≠',
    no: 'No',
    
    // Navigation
    home: 'Inicio',
    profile: 'Perfil',
    settings: 'Configuraci√≥n',
    transactions: 'Transacciones',
    send: 'Enviar',
    receive: 'Recibir',
    withdraw: 'Retirar',
    deposit: 'Depositar',
    
    // Home Screen
    balance: 'Saldo',
    quickActions: 'Acciones R√°pidas',
    recentTransactions: 'Transacciones Recientes',
    viewAll: 'Ver Todo',
    sendMoney: 'Enviar Dinero',
    receiveMoney: 'Recibir Dinero',
    withdrawFunds: 'Retirar Fondos',
    depositFunds: 'Depositar Fondos',
    
    // Send Modal
    sendToUser: 'Enviar a Usuario',
    addContact: 'Agregar Contacto',
    mobileMoney: 'Dinero M√≥vil',
    payInStore: 'Pagar en Tienda',
    bankTransfer: 'Transferencia Bancaria',
    cryptoTransfer: 'Transferencia Crypto',
    payBills: 'Pagar Facturas',
    
    // Receive Modal
    generateInvoice: 'Generar Factura',
    paymentLink: 'Enlace de Pago',
    qrCode: 'C√≥digo QR',
    
    // Profile Settings
    accountSecurity: 'Cuenta y Seguridad',
    paymentCards: 'Pagos y Tarjetas',
    servicesUtilities: 'Servicios y Utilidades',
    preferences: 'Preferencias',
    supportLegal: 'Soporte y Legal',
    editProfile: 'Editar Perfil',
    twoFactorAuth: 'Autenticaci√≥n de Dos Factores',
    faceIdBiometric: 'FaceID / Inicio de Sesi√≥n Biom√©trico',
    testBiometric: 'Probar Biom√©trico',
    virtualCards: 'Tarjetas Virtuales',
    transactionLimits: 'L√≠mites de Transacci√≥n',
    notifications: 'Notificaciones',
    language: 'Idioma',
    darkMode: 'Modo Oscuro',
    buyAirtimeData: 'Comprar Airtime y Datos',
    billPayments: 'Pago de Facturas',
    giftCards: 'Tarjetas de Regalo',
    cryptoServices: 'Servicios Crypto',
    helpSupport: 'Ayuda y Soporte',
    contactUs: 'Cont√°ctanos',
    inviteFriends: 'Invitar Amigos',
    learningHub: 'Centro de Aprendizaje',
    termsOfService: 'T√©rminos de Servicio',
    privacyPolicy: 'Pol√≠tica de Privacidad',
    
    // Biometric
    enableFaceId: 'Habilitar Face ID',
    enableTouchId: 'Habilitar Touch ID',
    enableBiometric: 'Habilitar Biom√©trico',
    biometricEnabled: 'Biom√©trico Habilitado',
    biometricDisabled: 'Biom√©trico Deshabilitado',
    securityCode: 'C√≥digo de Seguridad',
    setSecurityCode: 'Establecer C√≥digo de Seguridad',
    enterSecurityCode: 'Ingresar C√≥digo de Seguridad',
    createSecurityCode: 'Crear C√≥digo de Seguridad',
    confirmSecurityCode: 'Confirmar C√≥digo de Seguridad',
    securityCodeSetup: 'Configuraci√≥n de C√≥digo de Seguridad',
    biometricSetup: 'Configuraci√≥n Biom√©trica',
    biometricTest: 'Prueba Biom√©trica',
    
    // Airtime & Data
    buyAirtimeDataTitle: 'Comprar Airtime y Datos',
    serviceType: 'Tipo de Servicio',
    airtime: 'Airtime',
    dataBundle: 'Paquete de Datos',
    phoneNumber: 'N√∫mero de Tel√©fono',
    selectNetwork: 'Seleccionar Red',
    amount: 'Cantidad',
    selectDataBundle: 'Seleccionar Paquete de Datos',
    quickAmounts: 'Cantidades R√°pidas',
    purchase: 'Comprar',
    purchaseAirtime: 'Comprar Airtime',
    purchaseDataBundle: 'Comprar Paquete de Datos',
    
    // Transaction History
    transactionHistory: 'Historial de Transacciones',
    transactionDetails: 'Detalles de Transacci√≥n',
    transactionId: 'ID de Transacci√≥n',
    date: 'Fecha',
    time: 'Hora',
    status: 'Estado',
    amount: 'Cantidad',
    fee: 'Tarifa',
    total: 'Total',
    reference: 'Referencia',
    description: 'Descripci√≥n',
    recipient: 'Destinatario',
    sender: 'Remitente',
    
    // Actions
    share: 'Compartir',
    copy: 'Copiar',
    split: 'Dividir',
    report: 'Reportar',
    support: 'Soporte',
    
    // Status
    completed: 'Completado',
    pending: 'Pendiente',
    failed: 'Fallido',
    cancelled: 'Cancelado',
    
    // Messages
    success: '√âxito',
    error: 'Error',
    warning: 'Advertencia',
    info: 'Informaci√≥n',
    loading: 'Cargando...',
    noData: 'No hay datos disponibles',
    tryAgain: 'Por favor int√©ntalo de nuevo',
    networkError: 'Error de red',
    authenticationFailed: 'Autenticaci√≥n fallida',
    biometricNotAvailable: 'Biom√©trico no disponible',
    biometricSetupRequired: 'Configuraci√≥n biom√©trica requerida',
    
    // Language Selector
    selectLanguage: 'Seleccionar Idioma',
    currentLanguage: 'Idioma Actual',
    languageChanged: 'Idioma cambiado exitosamente',
    restartRequired: 'Reinicio de la aplicaci√≥n requerido para el cambio completo de idioma',
  },
  
  fr: {
    // Common
    cancel: 'Annuler',
    confirm: 'Confirmer',
    save: 'Enregistrer',
    delete: 'Supprimer',
    edit: 'Modifier',
    done: 'Termin√©',
    back: 'Retour',
    next: 'Suivant',
    skip: 'Passer',
    continue: 'Continuer',
    retry: 'R√©essayer',
    close: 'Fermer',
    ok: 'OK',
    yes: 'Oui',
    no: 'Non',
    
    // Navigation
    home: 'Accueil',
    profile: 'Profil',
    settings: 'Param√®tres',
    transactions: 'Transactions',
    send: 'Envoyer',
    receive: 'Recevoir',
    withdraw: 'Retirer',
    deposit: 'D√©poser',
    
    // Home Screen
    balance: 'Solde',
    quickActions: 'Actions Rapides',
    recentTransactions: 'Transactions R√©centes',
    viewAll: 'Voir Tout',
    sendMoney: 'Envoyer de l\'Argent',
    receiveMoney: 'Recevoir de l\'Argent',
    withdrawFunds: 'Retirer des Fonds',
    depositFunds: 'D√©poser des Fonds',
    
    // Send Modal
    sendToUser: 'Envoyer √† l\'Utilisateur',
    addContact: 'Ajouter un Contact',
    mobileMoney: 'Argent Mobile',
    payInStore: 'Payer en Magasin',
    bankTransfer: 'Virement Bancaire',
    cryptoTransfer: 'Transfert Crypto',
    payBills: 'Payer les Factures',
    
    // Receive Modal
    generateInvoice: 'G√©n√©rer une Facture',
    paymentLink: 'Lien de Paiement',
    qrCode: 'Code QR',
    
    // Profile Settings
    accountSecurity: 'Compte et S√©curit√©',
    paymentCards: 'Paiements et Cartes',
    servicesUtilities: 'Services et Utilitaires',
    preferences: 'Pr√©f√©rences',
    supportLegal: 'Support et L√©gal',
    editProfile: 'Modifier le Profil',
    twoFactorAuth: 'Authentification √† Deux Facteurs',
    faceIdBiometric: 'FaceID / Connexion Biom√©trique',
    testBiometric: 'Tester Biom√©trique',
    virtualCards: 'Cartes Virtuelles',
    transactionLimits: 'Limites de Transaction',
    notifications: 'Notifications',
    language: 'Langue',
    darkMode: 'Mode Sombre',
    buyAirtimeData: 'Acheter Cr√©dit et Donn√©es',
    billPayments: 'Paiement de Factures',
    giftCards: 'Cartes Cadeaux',
    cryptoServices: 'Services Crypto',
    helpSupport: 'Aide et Support',
    contactUs: 'Nous Contacter',
    inviteFriends: 'Inviter des Amis',
    learningHub: 'Centre d\'Apprentissage',
    termsOfService: 'Conditions de Service',
    privacyPolicy: 'Politique de Confidentialit√©',
    
    // Biometric
    enableFaceId: 'Activer Face ID',
    enableTouchId: 'Activer Touch ID',
    enableBiometric: 'Activer Biom√©trique',
    biometricEnabled: 'Biom√©trique Activ√©',
    biometricDisabled: 'Biom√©trique D√©sactiv√©',
    securityCode: 'Code de S√©curit√©',
    setSecurityCode: 'D√©finir le Code de S√©curit√©',
    enterSecurityCode: 'Entrer le Code de S√©curit√©',
    createSecurityCode: 'Cr√©er le Code de S√©curit√©',
    confirmSecurityCode: 'Confirmer le Code de S√©curit√©',
    securityCodeSetup: 'Configuration du Code de S√©curit√©',
    biometricSetup: 'Configuration Biom√©trique',
    biometricTest: 'Test Biom√©trique',
    
    // Airtime & Data
    buyAirtimeDataTitle: 'Acheter Cr√©dit et Donn√©es',
    serviceType: 'Type de Service',
    airtime: 'Cr√©dit',
    dataBundle: 'Forfait Donn√©es',
    phoneNumber: 'Num√©ro de T√©l√©phone',
    selectNetwork: 'S√©lectionner le R√©seau',
    amount: 'Montant',
    selectDataBundle: 'S√©lectionner le Forfait Donn√©es',
    quickAmounts: 'Montants Rapides',
    purchase: 'Acheter',
    purchaseAirtime: 'Acheter du Cr√©dit',
    purchaseDataBundle: 'Acheter un Forfait Donn√©es',
    
    // Transaction History
    transactionHistory: 'Historique des Transactions',
    transactionDetails: 'D√©tails de la Transaction',
    transactionId: 'ID de Transaction',
    date: 'Date',
    time: 'Heure',
    status: 'Statut',
    amount: 'Montant',
    fee: 'Frais',
    total: 'Total',
    reference: 'R√©f√©rence',
    description: 'Description',
    recipient: 'Destinataire',
    sender: 'Exp√©diteur',
    
    // Actions
    share: 'Partager',
    copy: 'Copier',
    split: 'Diviser',
    report: 'Signaler',
    support: 'Support',
    
    // Status
    completed: 'Termin√©',
    pending: 'En Attente',
    failed: '√âchou√©',
    cancelled: 'Annul√©',
    
    // Messages
    success: 'Succ√®s',
    error: 'Erreur',
    warning: 'Avertissement',
    info: 'Information',
    loading: 'Chargement...',
    noData: 'Aucune donn√©e disponible',
    tryAgain: 'Veuillez r√©essayer',
    networkError: 'Erreur r√©seau',
    authenticationFailed: '√âchec de l\'authentification',
    biometricNotAvailable: 'Biom√©trique non disponible',
    biometricSetupRequired: 'Configuration biom√©trique requise',
    
    // Language Selector
    selectLanguage: 'S√©lectionner la Langue',
    currentLanguage: 'Langue Actuelle',
    languageChanged: 'Langue chang√©e avec succ√®s',
    restartRequired: 'Red√©marrage de l\'application requis pour le changement complet de langue',
  },
};

// Create Provider Component
export const LanguageProvider = ({ children }) => {
  const [currentLanguage, setCurrentLanguage] = useState('en');
  const [isLoading, setIsLoading] = useState(true);

  // Load saved language preference
  useEffect(() => {
    loadLanguagePreference();
  }, []);

  const loadLanguagePreference = async () => {
    try {
      const savedLanguage = await AsyncStorage.getItem('app_language');
      if (savedLanguage && SUPPORTED_LANGUAGES[savedLanguage]) {
        setCurrentLanguage(savedLanguage);
      }
    } catch (error) {
      console.log('Error loading language preference:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const changeLanguage = async (languageCode) => {
    if (SUPPORTED_LANGUAGES[languageCode]) {
      try {
        await AsyncStorage.setItem('app_language', languageCode);
        setCurrentLanguage(languageCode);
        return true;
      } catch (error) {
        console.log('Error saving language preference:', error);
        return false;
      }
    }
    return false;
  };

  const t = (key) => {
    const translations = TRANSLATIONS[currentLanguage] || TRANSLATIONS.en;
    return translations[key] || key;
  };

  const getCurrentLanguageInfo = () => {
    return SUPPORTED_LANGUAGES[currentLanguage] || SUPPORTED_LANGUAGES.en;
  };

  const getSupportedLanguages = () => {
    return Object.values(SUPPORTED_LANGUAGES);
  };

  return (
    <LanguageContext.Provider
      value={{
        currentLanguage,
        changeLanguage,
        t,
        getCurrentLanguageInfo,
        getSupportedLanguages,
        isLoading,
      }}
    >
      {children}
    </LanguageContext.Provider>
  );
};

// Custom hook to use the language context
export const useLanguage = () => {
  const context = useContext(LanguageContext);
  if (context === undefined) {
    throw new Error('useLanguage must be used within a LanguageProvider');
  }
  return context;
};


